<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Sahil AI Cloud</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
    
    <style>
        /* --- AI CYBERPUNK THEME --- */
        :root { --primary: #00ffcc; --bg: #050505; --surface: #111; }
        body { 
            background-color: var(--bg); color: #fff; font-family: sans-serif; 
            margin: 0; padding: 0; padding-bottom: 100px; user-select: none;
        }
        
        /* Search Bar (AI Input) */
        .search-area {
            position: sticky; top: 0; z-index: 50;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            padding: 15px; border-bottom: 1px solid #333;
        }
        .search-box {
            width: 100%; background: #222; border: 1px solid #333;
            padding: 12px 20px; border-radius: 50px; color: #fff;
            font-size: 16px; outline: none; transition: 0.3s;
            background-image: url('https://cdn-icons-png.flaticon.com/512/11741/11741045.png'); /* Search Icon */
            background-size: 20px; background-repeat: no-repeat;
            background-position: 95% center;
        }
        .search-box:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0,255,204,0.3); }

        /* AI Status Badge */
        .ai-badge {
            text-align: center; font-size: 10px; color: var(--primary); 
            margin-top: 5px; letter-spacing: 1px; display: none;
        }

        /* Gallery Grid */
        .gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; padding: 2px; }
        .item { 
            width: 100%; aspect-ratio: 1/1; object-fit: cover; 
            background: #151515; position: relative;
        }
        .item-tag {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: rgba(0,0,0,0.7); color: #fff; font-size: 8px;
            padding: 2px; text-align: center; white-space: nowrap; overflow: hidden;
        }

        /* Floating Button */
        .fab-container { position: fixed; bottom: 85px; right: 20px; z-index: 100; }
        .fab {
            width: 65px; height: 65px; border-radius: 50%; border: none;
            background: var(--primary); color: #000; font-size: 35px;
            box-shadow: 0 0 25px rgba(0, 255, 204, 0.5);
            display: flex; align-items: center; justify-content: center;
        }

        /* AI Loader Overlay */
        #ai-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.96); display: none; z-index: 200;
            flex-direction: column; justify-content: center; align-items: center;
        }
        .scan-line {
            width: 100%; height: 2px; background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
            animation: scan 1.5s infinite;
        }
        @keyframes scan { 0% {transform: translateY(-100px); opacity:0;} 50% {opacity:1;} 100% {transform: translateY(100px); opacity:0;} }
    </style>
</head>
<body>

    <div id="ai-overlay">
        <img src="https://cdn-icons-png.flaticon.com/512/2103/2103633.png" width="60" style="filter: invert(1);">
        <h3 style="color:var(--primary); font-family:monospace; margin-bottom:50px;">AI ANALYZING...</h3>
        <div class="scan-line"></div>
        <p id="ai-text" style="color:#888; font-size:12px; margin-top:20px;">Identifying Objects...</p>
    </div>

    <div class="search-area">
        <input type="text" id="searchInp" class="search-box" placeholder="Search (e.g. 'Laptop', 'Car')..." onkeyup="filterGallery()">
        <div class="ai-badge" id="aiStatus">‚óè AI BRAIN ACTIVE</div>
    </div>

    <div class="gallery" id="grid"></div>

    <div class="fab-container">
        <button class="fab" onclick="document.getElementById('fileInp').click()">+</button>
    </div>
    <input type="file" id="fileInp" multiple accept="image/*" style="display:none" onchange="processWithAI()">
    <img id="tempImg" width="224" height="224" style="display:none">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL, listAll } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // CONFIG (Tumhari wali)
        const firebaseConfig = {
            apiKey: "AIzaSyDScnh2HnQS9N60mGTRKcthHoRpxpANpB0",
            authDomain: "sahil-cloud-gallery.firebaseapp.com",
            projectId: "sahil-cloud-gallery",
            storageBucket: "sahil-cloud-gallery.firebasestorage.app",
            messagingSenderId: "324079201866",
            appId: "1:324079201866:web:634840b962a96988d280b3",
            measurementId: "G-SY8911CV7E"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        const grid = document.getElementById('grid');
        let aiModel = null;

        // 1. LOAD AI MODEL (Background)
        async function loadAI() {
            try {
                console.log("Loading AI...");
                aiModel = await mobilenet.load();
                document.getElementById('aiStatus').style.display = 'block';
                console.log("AI Ready!");
            } catch (e) { console.error("AI Load Failed", e); }
        }
        loadAI();

        // 2. AI PROCESSING LOGIC
        window.processWithAI = async function() {
            const files = document.getElementById('fileInp').files;
            if(!files.length) return;

            document.getElementById('ai-overlay').style.display = 'flex';
            const aiText = document.getElementById('ai-text');

            for (let file of files) {
                // Image recognition step
                let tags = "IMG";
                if(file.type.startsWith('image') && aiModel) {
                    aiText.innerText = "Scanning: " + file.name;
                    tags = await predictImage(file); // AI guess karega
                }

                // AI Renaming the file
                const newName = `${tags}_${Date.now()}.jpg`; // Example: Laptop_12345.jpg
                
                // Upload logic
                aiText.innerText = "Uploading to Cloud: " + tags;
                await uploadFile(file, newName);
            }

            document.getElementById('ai-overlay').style.display = 'none';
            alert("‚úÖ AI Scan Complete! Photos Saved.");
        };

        // Helper: Predict what is in the image
        function predictImage(file) {
            return new Promise((resolve) => {
                const img = document.getElementById('tempImg');
                img.src = URL.createObjectURL(file);
                img.onload = async () => {
                    const predictions = await aiModel.classify(img);
                    // Sabse top prediction le lo (e.g. 'cup')
                    if(predictions && predictions.length > 0) {
                        const cleanTag = predictions[0].className.split(',')[0].replace(/\s/g, '');
                        resolve(cleanTag);
                    } else {
                        resolve("Unknown");
                    }
                };
            });
        }

        // 3. UPLOAD TO FIREBASE
        function uploadFile(file, name) {
            return new Promise((resolve) => {
                const sRef = ref(storage, 'AI_Gallery/' + name);
                const task = uploadBytesResumable(sRef, file);
                task.on('state_changed', null, null, () => {
                    getDownloadURL(task.snapshot.ref).then(url => {
                        displayItem(url, name);
                        resolve();
                    });
                });
            });
        }

        // 4. DISPLAY & SEARCH
        function loadGallery() {
            listAll(ref(storage, 'AI_Gallery/')).then(res => {
                res.items.forEach(item => {
                    getDownloadURL(item).then(url => displayItem(url, item.name));
                });
            });
        }

        function displayItem(url, name) {
            // Name se tags nikalo (Example: Laptop_123.jpg -> Tag: Laptop)
            const tag = name.split('_')[0]; 

            const div = document.createElement('div');
            div.className = 'item';
            div.style.backgroundImage = `url('${url}')`;
            div.setAttribute('data-tag', tag.toLowerCase()); // Search ke liye
            div.onclick = () => window.open(url, '_blank');

            // Show AI Tag on image
            const tagEl = document.createElement('div');
            tagEl.className = 'item-tag';
            tagEl.innerText = "ü§ñ " + tag;
            div.appendChild(tagEl);

            grid.prepend(div);
        }

        // 5. SEARCH FILTER FUNCTION
        window.filterGallery = function() {
            const query = document.getElementById('searchInp').value.toLowerCase();
            const items = document.querySelectorAll('.item');
            
            items.forEach(item => {
                const tag = item.getAttribute('data-tag');
                if(tag.includes(query) || query === "") {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        };

        loadGallery();
    </script>
</body>
</html>
